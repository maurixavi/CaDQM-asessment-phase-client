
<div class="container my-4">
  <app-step-navigator 
		[pageStepTitle]="pageStepTitle" 
		[phaseTitle]="phaseTitle" 
		[stageTitle]="stageTitle" 
		[currentStep]="currentStep">
	</app-step-navigator>


  <h4>Add DQ Dimensions and DQ Factors from scratch</h4>
  <!-- Selector de Dimensiones -->
  <div class="form-group">
    <label for="dqDimension">DQ Dimension</label>
    <select 
      id="dqDimension" 
      class="form-control" 
      [(ngModel)]="selectedDimension" 
      (change)="onDimensionChange()">
      <option value="" disabled selected>Select a dimension</option>
      <option *ngFor="let dimension of dqDimensionsBase" [ngValue]="dimension.id">
        {{ dimension.name }}
      </option>
    </select>
  </div>
  

  <!-- Selector de Factores (siempre visible) -->
  <div class="form-group">
    <label for="dqFactor">DQ Factor</label>
    <select 
      id="dqFactor" 
      class="form-control" 
      [(ngModel)]="selectedFactor"
      (change)="onFactorChange()">
      <option value="" disabled selected>Select a factor</option>
      <ng-container *ngIf="selectedDimension">
        <option *ngFor="let factor of availableFactors" [ngValue]="factor.id">
          {{ factor.name }}
        </option>
      </ng-container>
    </select>
  </div> 

  <!-- Botón para agregar el par -->
  <button 
  type="button" 
  class="btn btn-primary" 
  (click)="addDimensionFactorPair()" 
  [disabled]="!selectedDimension || !selectedFactor">
  Add
  </button>

  <!-- Mensaje de Alerta -->
  <div *ngIf="duplicateFactor" class="alert alert-warning mt-2">
    Este par de dimensión y factor ya ha sido agregado.
  </div>

  <!-- Lista de pares de dimensión y factor seleccionados 
  <div *ngIf="getDimensionFactorPairs().length > 0">
    <h3>Pares Seleccionados:</h3>
    <ul>
      <li *ngFor="let pair of getDimensionFactorPairs()">
        <strong>Dimension:</strong> {{ pair.dimension?.name }} - <strong>Factor:</strong> {{ pair.factor?.name }}
      </li>
    </ul>
  </div> -->
  <!-- Selector de Factores (siempre visible)
  <div class="form-group">
    <label for="dqFactor">DQ Factor</label>
    <select 
      id="dqFactor" 
      class="form-control" 
      [(ngModel)]="selectedFactor">
      <option value="" disabled selected>Select a factor</option>
      <ng-container *ngIf="selectedDimension">
        <option *ngFor="let factor of getFactorsByDimension(selectedDimension)" [ngValue]="factor.id">
          {{ factor.name }}
        </option>
      </ng-container>
    </select>
  </div> -->

  <br><br>

 

  <!-- LISTADO TOTAL ------ Dimensiones y sus Factores Asociados 
  <div *ngFor="let dimension of qualityDimensions">
    <h3>{{ dimension.name }}</h3>
    <p>{{ dimension.semantic }}</p>-->

    <!-- Lista de Factores dentro de cada Dimensión
    <ul>
      <li *ngFor="let factor of getFactorsByDimension(dimension.id)">
        <strong>{{ factor.name }}</strong>: {{ factor.semantic }}
      </li>
      <li *ngIf="getFactorsByDimension(dimension.id).length === 0">
        No hay factores asociados a esta dimensión.
      </li>
    </ul>
  </div> -->

  <!-- ACCORDION se muestran VARIOS A LA VEZ 
  <div *ngIf="getDimensionFactorPairs().length > 0">
    <h3>Dimensions and Factors selected</h3>
  
    <h5>DQ Dimensions:</h5>
    <div class="accordion" id="accordionExample">
      <div class="accordion-item" *ngFor="let dimension of selectedDimensions; let i = index">
        <h2 class="accordion-header" [id]="'heading' + i">
          <button
            class="accordion-button"
            type="button"
            data-bs-toggle="collapse"
            [attr.data-bs-target]="'#collapse' + i"
            aria-expanded="true"
            [attr.aria-controls]="'collapse' + i"
          >
            {{ dimension.name }}
          </button>
        </h2>
        <div
          [id]="'collapse' + i"
          class="accordion-collapse collapse"
          [class.show]="i === 0"
          [attr.aria-labelledby]="'heading' + i"
        >
          <div class="accordion-body">
            <strong>Semantic:</strong> {{ dimension.semantic }} <br><br>
  
          
            <h5>DQ Factors:</h5>
  
            <div class="accordion mt-3" [id]="'factorAccordion' + i">
              <div
                class="accordion-item"
                *ngFor="let factor of getSelectedFactorsByDimension(dimension.id); let j = index"
              >
                <h2 class="accordion-header" [id]="'factorHeading' + i + '-' + j">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    [attr.data-bs-target]="'#factorCollapse' + i + '-' + j"
                    aria-expanded="false"
                    [attr.aria-controls]="'factorCollapse' + i + '-' + j"
                  >
                    {{ factor.name }}
                  </button>
                </h2>
                <div
                  [id]="'factorCollapse' + i + '-' + j"
                  class="accordion-collapse collapse"
                  [attr.aria-labelledby]="'factorHeading' + i + '-' + j"
                >
                  <div class="accordion-body">
                    <strong>Semantic:</strong> {{ factor.semantic }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  -->
   
  <!--
  <ul>
    @for (dimension of modelService.dimensions; track $index){
    <li>
      <a [routerLink]="dimension.id">
        <div class="">
          <h2>{{ $index + 1 }}</h2>
          <h2>{{ dimension.name }}</h2>
        </div>
      </a>
    </li>
    }
  </ul>

  
  <ul>
    @for (user of modelService.users; track $index){
    <li>
      <a [routerLink]="user.id">
        <div class="">
          <h2>{{ $index + 1 }}</h2>
          <h2>{{ user.name }}</h2>
        </div>
      </a>
    </li>
    }
  </ul>
  -->

 

  <!--<div class="context-selection">
    <select class="form-select " [(ngModel)]="selectedComponent">
      <option [ngValue]="undefined">Select Ctx. component</option>
      <option *ngFor="let component of contextComponents" [ngValue]="component">
        {{component.displayText}}
      </option>
    </select>
  
    <button class="btn btn-primary" (click)="addContextComponent()" 
            [disabled]="!selectedComponent">
      Add Component
    </button>
  
    <div class="selected-components mt-3" *ngIf="selectedComponents.length > 0">
      <h4>Selected Components:</h4>
      <ul class="list-group">
        <li *ngFor="let component of selectedComponents" class="list-group-item">
          {{component.displayText}}
          <button class="btn btn-danger btn-sm float-end" 
                  (click)="removeContextComponent(component)">
            Remove
          </button>
        </li>
      </ul>
    </div>
  </div>
-->



  <p class="subtitle-description">Add Dimensions and Factors from scratch</p>
  <div class="flex-container">
    <div class="suggested-section-container p-4">
      <div>

        <div class="label-container">
          <div class="label">
            <label class="label-title">DQ Dimension:</label>
            <span class="label-value d-flex align-items-center">

              <select 
                class="form-select select-style"   
                id="dqDimension"
                [(ngModel)]="selectedDimension" 
                (change)="onDimensionChange()"
                aria-label="Default select example"
              >
                <option value="" disabled>Select existing</option>
                <option *ngFor="let dimension of dqDimensionsBase" [ngValue]="dimension.id">
                  {{ dimension.name }}
                </option>
              </select>
          
              <button class="btn btn-light  mx-2" (click)="openModal()">Add new</button>
            </span>
          </div>

          <!--Add New Dimension modal form-->
          <!--<div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': isModalOpen}" [style.display]="isModalOpen ? 'block' : 'none'">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Add new DQ Dimension</h5>
                  <button type="button" class="close" aria-label="Close" (click)="closeModal()">
                    <span aria-hidden="true"><i class="bi bi-x-lg"></i></span>
                  </button>
                </div>
                <div class="modal-body">
                  <form>
                    <div class="form-group">
                      <label for="projectTitle">Name</label>
                      <input type="text" class="form-control" id="projectName" placeholder="Enter DQ Dimension name">
                    </div>
                    <div class="form-group">
                      <label for="projectDescription">Semantic</label>
                      <input type="text" class="form-control" id="projectDescription" placeholder="Enter DQ Dimension semantic">
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-sm btn-light" (click)="closeModal()">Cancel</button>
                  <button type="button" class="btn btn-sm btn-dark" routerLink="/step1">Confirm</button>
                </div>
              </div>
            </div>
          </div>-->
          <!-- Add New Dimension modal form -->
          <div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': isModalOpen}" [style.display]="isModalOpen ? 'block' : 'none'">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Add new DQ Dimension</h5>
                  <button type="button" class="close" aria-label="Close" (click)="closeModal()">
                    <span aria-hidden="true"><i class="bi bi-x-lg"></i></span>
                  </button>
                </div>
                <div class="modal-body">
                  <form (ngSubmit)="createDimension()">
                    <div class="form-group">
                      <label for="dimensionName">Name</label>
                      <input type="text" class="form-control" id="dimensionName" [(ngModel)]="dimensionName" name="dimensionName" placeholder="Enter DQ Dimension name" required>
                    </div>
                    <div class="form-group">
                      <label for="dimensionSemantic">Semantic</label>
                      <input type="text" class="form-control" id="dimensionSemantic" [(ngModel)]="dimensionSemantic" name="dimensionSemantic" placeholder="Enter DQ Dimension semantic" required>
                    </div>
                    <div *ngIf="errorMessage" class="text-danger">{{ errorMessage }}</div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-sm btn-light" (click)="closeModal()">Cancel</button>
                  <button type="submit" class="btn btn-sm btn-dark" (click)="createDimension()">Confirm</button>
                </div>
              </div>
            </div>
          </div>


          <!--Mostrar Dimension seleccionada/creado-->
          <div *ngIf="selectedDimension !== null">
            <div class="label-container-selected py-2 px-4">
              <div class="label-selected">
                <span class="label-name-selected">{{ getSelectedDimension()?.name }}</span>
              </div>
              <div class="label-selected">
                <label class="label-title-selected">Semantic:</label>
                <span class="label-value-selected">{{ getSelectedDimension()?.semantic }}</span>
              </div>  
            </div>

            <button class="btn btn-light btn-sm mx-4 my-2 mb-4" (click)="openModal()">Edit</button>
          </div>

          <div class="label">
            <label class="label-title">DQ Factor:</label>
            <span class="label-value d-flex align-items-center">
              <select 
                id="dqFactor" 
                class="form-select select-style" 
                [(ngModel)]="selectedFactor"
                (change)="onFactorChange()"
                aria-label="Select a factor">
                <option value="" disabled selected>Select existing</option>
                <ng-container *ngIf="selectedDimension">
                  <option *ngFor="let factor of availableFactors" [ngValue]="factor.id">
                    {{ factor.name }}
                  </option>
                </ng-container>
              </select>

              <button class="btn btn-light  mx-2" (click)="openFactorModal()">Add new</button>
            </span>
          </div>
          <!-- Mensaje informativo si no hay factores -->
          <div *ngIf="noFactorsMessage" class="alert alert-warning mt-2">
            {{ noFactorsMessage }}
          </div>

          <!-- Modal para Agregar Nuevo Factor -->
          <div class="modal" tabindex="-1" role="dialog" [ngClass]="{'show': isFactorModalOpen}" [style.display]="isFactorModalOpen ? 'block' : 'none'">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Add New DQ Factor</h5>
                  <button type="button" class="close" aria-label="Close" (click)="closeFactorModal()">
                    <span aria-hidden="true"><i class="bi bi-x-lg"></i></span>
                  </button>
                </div>
                <div class="modal-body">
                  <form (ngSubmit)="createFactor()">
                    <div class="form-group">
                      <label for="factorName">Name</label>
                      <input type="text" class="form-control" id="factorName" [(ngModel)]="factorName" name="factorName" placeholder="Enter DQ Factor name" required>
                    </div>
                    <div class="form-group">
                      <label for="factorSemantic">Semantic</label>
                      <input type="text" class="form-control" id="factorSemantic" [(ngModel)]="factorSemantic" name="factorSemantic" placeholder="Enter DQ Factor semantic" required>
                    </div>

                    <!-- Mostrar la Dimensión Seleccionada -->
                    <div class="form-group">
                      <label for="selectedDimension">Selected Dimension</label>
                      <input type="text" class="form-control" id="selectedDimension" [value]="selectedDimensionName" readonly>
                    </div>

                    
                  </form>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-sm btn-light" (click)="closeFactorModal()">Cancel</button>
                  <button type="submit" class="btn btn-sm btn-dark" (click)="createFactor()">Confirm</button>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="errorMessage" class="text-danger">{{ errorMessage }}</div>

          <!--Mostrar Factor seleccionado/creado-->
          <div *ngIf="selectedFactor !== null">
            <div class="label-container-selected py-2 px-4">
              <div class="label-selected">
                <span class="label-name-selected">{{ getSelectedFactor()?.name }}</span>
              </div>
              <div class="label-selected">
                <label class="label-title-selected">Semantic:</label>
                <span class="label-value-selected">{{ getSelectedFactor()?.semantic }}</span>
              </div>
            </div>
          
            <button class="btn btn-light btn-sm mx-4 my-2 mb-4" (click)="openModal()">Edit</button>
          </div>

        </div>
        
        <!--Context Components-->
        <div class="d-flex justify-content-between px-4 py-3" style="gap: 20px;">
          <div class="from-ctx-components  flex-fill ">
            <p class="">From Context Components:</p>

            <span class="label-value d-flex align-items-center">
            <!--<button class="btn btn-light btn-sm" >
              Select <i class="bi bi-chevron-down"></i>
            </button>-->
            <div class="context-selection">
              <!--<select class="form-select select-style-ctx" [(ngModel)]="selectedComponent">
                <option [ngValue]="undefined">Select Ctx. component</option>
                <option *ngFor="let component of contextComponents" [ngValue]="component">
                  {{component.displayText}}
                </option>
              </select>-->

              <select class="form-select select-style-ctx" 
                [(ngModel)]="selectedComponent" 
                (ngModelChange)="onComponentSelect()">
                <option [ngValue]="undefined">Select Ctx. component</option>
                <option *ngFor="let component of contextComponents" [ngValue]="component">
                  {{component.displayText}}
                </option>
              </select>
            
              <!--<button class="btn btn-primary" (click)="addContextComponent()" 
                      [disabled]="!selectedComponent">
                Add Component
              </button>-->
            
              <div class="selected-components mt-3" *ngIf="selectedComponents.length > 0">
                <ul class="list-group">
                  <li *ngFor="let component of selectedComponents" class="list-group-item">
                    {{component.displayText}}
                    <button class="btn btn-danger btn-sm float-end" 
                            (click)="removeContextComponent(component)">
                      X
                    </button>
                  </li>
                </ul>
              </div>
            </div>
            
            <!--<button 
              class="btn btn-primary my-2 mx-2" 
              (click)="addContextComponent()" 
              [disabled]="!selectedComponent">
                Add
            </button>-->


            </span>
          </div>

          <div class="from-ctx-components flex-fill ">
            <p class="fst-italic">From DQ Problems:</p>

            <button class="btn btn-light btn-sm" >Select</button>
          </div>
        </div>

      </div>

      <button 
        type="button" 
        class="btn btn-dark mt-4" 
        (click)="addToDQModel()" 
        [disabled]="!selectedDimension || !selectedFactor">
        Add to DQ Model
      </button>

      <!-- Mensaje de Alerta -->
      <div *ngIf="duplicateFactor" class="alert alert-warning mt-2">
        Este par de dimensión y factor ya ha sido agregado.
      </div>

    </div>
  </div>
  

  <!-- Lista de pares de dimensión y factor seleccionados -->
  <div *ngIf="getDimensionFactorPairs().length > 0">
    <h3>Dimensions and Factors selected</h3>

    <h5>DQ Dimensions:</h5>
    <div class="accordion" id="accordionExample">
      <div class="accordion-item" *ngFor="let dimension of selectedDimensions; let i = index">
        <h2 class="accordion-header" [id]="'heading' + i">
          <button
            class="accordion-button"
            type="button"
            data-bs-toggle="collapse"
            [attr.data-bs-target]="'#collapse' + i"
            aria-expanded="true"
            [attr.aria-controls]="'collapse' + i"
          >
            {{ dimension.name }}
          </button>
        </h2>
        <div
          [id]="'collapse' + i"
          class="accordion-collapse collapse"
          [class.show]="i === 0"
          [attr.aria-labelledby]="'heading' + i"
          data-bs-parent="#accordionExample"
        >
          <div class="accordion-body">
            <strong>Semantic:</strong> {{ dimension.semantic }} <br><br>

            <!-- FACTORS Selected for DIMENSION -->
            <h5>DQ Factors:</h5>

            <!-- Acordeón para los factores seleccionados asociados a la dimensión -->
            <div class="accordion mt-3" [id]="'factorAccordion' + i">
              <div
                class="accordion-item"
                *ngFor="let factor of getSelectedFactorsByDimension(dimension.id); let j = index"
              >
                <h2 class="accordion-header" [id]="'factorHeading' + i + '-' + j">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    [attr.data-bs-target]="'#factorCollapse' + i + '-' + j"
                    aria-expanded="false"
                    [attr.aria-controls]="'factorCollapse' + i + '-' + j"
                  >
                    {{ factor.name }}
                  </button>
                </h2>
                <div
                  [id]="'factorCollapse' + i + '-' + j"
                  class="accordion-collapse collapse"
                  [attr.aria-labelledby]="'factorHeading' + i + '-' + j"
                  [attr.data-bs-parent]="'#factorAccordion' + i"
                >
                  <div class="accordion-body">
                    <strong>Semantic:</strong> {{ factor.semantic }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Mostrar factores asociados a la dimensión seleccionada
            <ul *ngIf="getFactorsByDimension(dimension.id).length > 0">
              <li *ngFor="let factor of getSelectedFactorsByDimension(dimension.id)">
                <strong>{{ factor.name }}</strong>: {{ factor.description }}
              </li>
            </ul>  -->
            
          </div>
        </div>
      </div>
    </div>
  </div> 


<app-context-components></app-context-components>